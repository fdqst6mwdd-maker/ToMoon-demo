<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToMoon Insight</title>
    <style>
        :root {
            --bg-dark: #0f1115;
            --bg-card: #1a1d24;
            --bg-panel: #232730;
            --primary: #3b82f6;
            --primary-hover: #2563eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --text-main: #e2e8f0;
            --text-muted: #94a3b8;
            --border: #334155;
            --sidebar-width: 250px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- Sidebar --- */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .brand { font-size: 20px; font-weight: 700; margin-bottom: 20px; color: white; display: flex; align-items: center; gap: 10px; }
        
        .nav-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .nav-item {
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: var(--text-main); }
        .nav-item.active { background: rgba(59, 130, 246, 0.1); color: var(--primary); font-weight: 600; }
        
        /* Nested Nav */
        .nav-sub-group {
            display: flex;
            flex-direction: column;
            gap: 2px;
            padding-left: 12px; /* Indent */
            margin-bottom: 5px;
            position: relative;
        }
        /* Line guide for tree structure */
        .nav-sub-group::before {
            content: '';
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 1px;
            background: var(--border);
            opacity: 0.5;
        }

        .nav-sub-item {
            padding: 8px 15px 8px 25px; /* Extra padding for indent */
            border-radius: 6px;
            cursor: pointer;
            color: var(--text-muted);
            font-size: 13px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        .nav-sub-item:hover {
            color: var(--text-main);
            background: rgba(255,255,255,0.03);
        }
        .nav-sub-item.active {
            color: var(--primary);
            background: rgba(59, 130, 246, 0.05);
            font-weight: 500;
        }
        /* Dot for active sub item */
        .nav-sub-item.active::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
        }

        /* --- Main Layout --- */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* --- Components --- */
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        .btn { padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer; font-weight: 500; font-size: 13px; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-muted); }
        
        .text-green { color: var(--success); }
        .text-red { color: var(--danger); }
        .text-warning { color: var(--warning); }

        /* --- KPI Grid --- */
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
        .kpi-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px; padding: 20px; display: flex; flex-direction: column; }
        .kpi-label { font-size: 13px; color: var(--text-muted); margin-bottom: 8px; }
        .kpi-value { font-size: 24px; font-weight: 700; margin-bottom: 5px; }
        .kpi-trend { font-size: 12px; display: flex; align-items: center; gap: 5px; }

        /* --- Charts Area --- */
        .chart-container { height: 250px; background: var(--bg-panel); border-radius: 8px; display: flex; align-items: center; justify-content: center; position: relative; }
        .chart-placeholder { color: var(--text-muted); font-size: 14px; }
        
        /* Simple CSS Bar Chart for Demo */
        .bar-chart { display: flex; align-items: flex-end; gap: 10px; height: 150px; padding: 20px; }
        .bar { width: 30px; background: var(--primary); border-radius: 4px 4px 0 0; position: relative; transition: height 0.5s; }
        .bar:hover { opacity: 0.8; }
        .bar-label { position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); font-size: 11px; color: var(--text-muted); }
        .bar-val { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); font-size: 11px; color: white; }

        /* --- Insight Cards --- */
        .insight-list { display: flex; flex-direction: column; gap: 15px; }
        .insight-item { display: flex; gap: 15px; padding: 15px; background: var(--bg-panel); border-radius: 8px; border-left: 3px solid var(--primary); }
        .insight-icon { font-size: 20px; }
        .insight-content h4 { margin: 0 0 5px 0; font-size: 14px; }
        .insight-content p { margin: 0; font-size: 13px; color: var(--text-muted); line-height: 1.4; }

        /* --- DMI Specifics --- */
        .dmi-grid { display: grid; grid-template-columns: 3fr 1fr; gap: 20px; margin-bottom: 20px; }
        
        .regime-badge { padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; display: inline-flex; align-items: center; gap: 6px; }
        .regime-strong { background: rgba(16, 185, 129, 0.15); color: var(--success); border: 1px solid rgba(16, 185, 129, 0.3); }
        .regime-stable { background: rgba(245, 158, 11, 0.15); color: var(--warning); border: 1px solid rgba(245, 158, 11, 0.3); }
        .regime-risky { background: rgba(239, 68, 68, 0.15); color: var(--danger); border: 1px solid rgba(239, 68, 68, 0.3); }

        .driver-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); }
        .driver-row:last-child { border-bottom: none; }
        .driver-name { font-size: 13px; color: var(--text-main); }
        .driver-impact { font-size: 13px; font-weight: 600; }
        
        .context-metric { display: flex; flex-direction: column; gap: 4px; }
        .context-label { font-size: 11px; color: var(--text-muted); }
        .context-val { font-size: 16px; font-weight: 600; }

        /* --- View Sections --- */
        .view-section { display: none; animation: fadeIn 0.3s; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Heatmap Grid --- */
        .heatmap-container { display: grid; grid-template-columns: 100px repeat(5, 1fr); gap: 5px; margin-top: 20px; }
        .hm-cell { height: 50px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 600; color: rgba(255,255,255,0.8); transition: transform 0.2s; cursor: pointer; }
        .hm-cell:hover { transform: scale(1.05); z-index: 1; border: 1px solid white; }
        .hm-label { display: flex; align-items: center; font-size: 12px; color: var(--text-muted); }
        .hm-header { text-align: center; font-size: 12px; color: var(--text-muted); padding-bottom: 5px; }

        /* --- Report Typography --- */
        .report-section { margin-bottom: 30px; }
        .report-title { font-size: 16px; font-weight: 700; color: var(--text-main); margin-bottom: 10px; display: flex; align-items: center; gap: 10px; }
        .report-text { font-size: 14px; color: var(--text-muted); line-height: 1.6; margin-bottom: 15px; }
        .highlight-box { background: rgba(59, 130, 246, 0.05); border-left: 3px solid var(--primary); padding: 15px; border-radius: 0 8px 8px 0; margin: 15px 0; }

        /* Report List */
        .report-list { display: flex; flex-direction: column; gap: 10px; }
        .report-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; background: var(--bg-panel); border-radius: 8px; cursor: pointer; transition: 0.2s; }
        .report-item:hover { background: rgba(255,255,255,0.05); }
        .report-meta { display: flex; flex-direction: column; gap: 4px; }
        .report-date { font-size: 12px; color: var(--text-muted); }
        .report-name { font-size: 14px; font-weight: 600; color: var(--text-main); }
        .report-status { font-size: 11px; padding: 2px 8px; border-radius: 10px; background: rgba(16, 185, 129, 0.1); color: var(--success); }

    </style>
</head>
<body>

<!-- Sidebar (Áî±ÂÖ±‰∫´Ê®°ÂùóÁîüÊàê) -->
<aside class="sidebar" id="sidebar"></aside>
<script src="../shared/sidebar.js"></script>
<script>
    // Ëá™Âä®ÂàùÂßãÂåñ‰æßËæπÊ†è - InsightÈ°µÈù¢ÂêØÁî®È°µÈù¢ÂÜÖÂàáÊç¢
    autoInitSidebar({ 
        internalSwitch: true, 
        switchFunction: 'switchViewFromSidebar',
        title: 'Discipline Management Index'
    });
    
    // ÂåÖË£ÖÂáΩÊï∞Áî®‰∫é‰æßËæπÊ†èË∞ÉÁî®
    function switchViewFromSidebar(viewId) {
        switchView(viewId);
    }
    
    // Â¶ÇÊûúURLÊúâÂèÇÊï∞ÔºåÂú®È°µÈù¢Âä†ËΩΩÊó∂ÂàáÊç¢Âà∞ÂØπÂ∫îËßÜÂõæ
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const view = urlParams.get('view');
        if (view === 'performance') {
            switchView('performance');
            updateSidebarActive('performance');
        } else if (view === 'behavior') {
            switchView('behavior');
            updateSidebarActive('behavior');
        } else if (view === 'ai-report') {
            switchView('ai-report');
            updateSidebarActive('ai-report');
        } else {
            switchView('dmi');
            updateSidebarActive('dmi');
        }
    });
</script>

<main class="main-content">
    
    <div class="header-row">
        <div>
            <p style="margin: 0; font-size: 13px; color: var(--text-muted);" id="page-desc">Monitor your execution quality and psychological state.</p>
        </div>
    </div>

    <!-- VIEW 1: DMI System (Existing) -->
    <div id="view-dmi" class="view-section active">
        <!-- Top Row: DMI Thermometer & State -->
        <div class="dmi-grid">
            
            <!-- DMI Thermometer & Status -->
            <div class="card" style="grid-column: span 2; display: flex; flex-direction: row; gap: 40px; align-items: center; padding: 30px;">
                
                <!-- Thermometer Visual -->
                <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                    <!-- Wrapper for Markers -->
                    <div style="position: relative; width: 40px; height: 200px;">
                        
                        <!-- The Tube (Clipped) -->
                        <div style="width: 100%; height: 100%; background: rgba(255,255,255,0.05); border-radius: 20px; border: 1px solid var(--border); position: relative; overflow: hidden;">
                            <!-- Zones Background -->
                            <div style="position: absolute; inset: 0; background: linear-gradient(to top, 
                                rgba(239, 68, 68, 0.2) 0%, 
                                rgba(245, 158, 11, 0.2) 40%, 
                                rgba(16, 185, 129, 0.2) 70%, 
                                rgba(16, 185, 129, 0.4) 100%);"></div>
                            
                            <!-- Mercury Level -->
                            <div id="dmi-mercury" style="position: absolute; bottom: 0; left: 0; right: 0; height: 82%; 
                                        background: linear-gradient(to top, var(--primary) 0%, #60a5fa 100%); 
                                        border-radius: 0;
                                        box-shadow: 0 0 15px rgba(59, 130, 246, 0.5); transition: height 0.1s ease-out, background 0.1s;">
                                <!-- Top Shine -->
                                <div style="position: absolute; top: 0; left: 0; right: 0; height: 2px; background: rgba(255,255,255,0.8);"></div>
                            </div>
                        </div>

                        <!-- Scale Markers -->
                        <div style="position: absolute; right: -25px; top: 0; bottom: 0; display: flex; flex-direction: column; justify-content: space-between; font-size: 10px; color: var(--text-muted); padding: 5px 0;">
                            <span>100</span>
                            <span>75</span>
                            <span>50</span>
                            <span>25</span>
                            <span>0</span>
                        </div>
                    </div>
                    <div id="dmi-score" style="font-weight: 700; font-size: 18px; color: var(--text-main);">82</div>
                    <!-- Debug Slider -->
                    <input type="range" min="0" max="100" value="82" oninput="updateDMI(this.value)" style="width: 60px; cursor: pointer; margin-top: 5px;" title="Drag to simulate DMI score">
                </div>

                <!-- Status Info -->
                <div style="flex: 1;">
                    <div class="header-row" style="margin-bottom: 10px;">
                        <h3 style="margin:0; font-size: 20px;">Discipline Status</h3>
                        <span id="dmi-badge" class="regime-badge regime-strong">üü¢ Strong Discipline</span>
                    </div>
                    
                    <p id="dmi-desc" style="font-size: 14px; color: var(--text-muted); line-height: 1.6; margin-bottom: 20px;">
                        Your trading discipline is currently in the <strong>Strong Zone</strong>. You are executing your strategy with high consistency and minimal emotional interference.
                    </p>

                    <div style="display: flex; gap: 30px; border-top: 1px solid var(--border); padding-top: 20px;">
                        <div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Data Sample</div>
                            <div style="font-size: 16px; font-weight: 600;">50 Trades</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Trend</div>
                            <div style="font-size: 16px; font-weight: 600; color: var(--success);">‚Üó Rising</div>
                        </div>
                        <div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 4px;">Consistency</div>
                            <div style="font-size: 16px; font-weight: 600; color: var(--text-main);">94%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle Row: Drivers & Context -->
        <div class="dmi-grid" style="grid-template-columns: 1fr 1fr;">
            
            <!-- DMI Drivers (Attribution) -->
            <div class="card">
                <div class="header-row">
                    <h3>Behavioral Impact on DMI</h3>
                    <span style="font-size: 12px; color: var(--text-muted);">Score Impact</span>
                </div>
                
                <div style="margin-top: 10px;">
                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 8px; text-transform: uppercase;">Negative Contributors</div>
                    <div class="driver-row">
                        <div class="driver-name">‚õî Breakout: Low Plan Compliance</div>
                        <div class="driver-impact text-red">-5</div>
                    </div>
                    <div class="driver-row">
                        <div class="driver-name">‚ö†Ô∏è Reversal: Early Exit</div>
                        <div class="driver-impact text-warning">-2</div>
                    </div>

                    <div style="font-size: 11px; color: var(--text-muted); margin: 15px 0 8px 0; text-transform: uppercase;">Positive Contributors</div>
                    <div class="driver-row">
                        <div class="driver-name">‚úÖ Trend Following: High Efficiency</div>
                        <div class="driver-impact text-green">+12</div>
                    </div>
                    <div class="driver-row">
                        <div class="driver-name">‚úÖ Risk Consistency</div>
                        <div class="driver-impact text-green">+8</div>
                    </div>
                </div>
            </div>

            <!-- Market Context (Background Info) -->
            <div class="card">
                <div class="header-row">
                    <h3>Market Context Forecast</h3>
                    <span style="font-size: 12px; color: var(--text-muted);">DMI Outlook</span>
                </div>
                <p style="font-size: 13px; color: var(--text-muted); margin-top: 0;">
                    How current market conditions might affect your future discipline.
                </p>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                    <div class="context-metric">
                        <span class="context-label">Active Strategy</span>
                        <span class="context-val" style="font-size: 14px; color: var(--primary);">Trend Following</span>
                    </div>
                    <div class="context-metric">
                        <span class="context-label">Market Condition</span>
                        <span class="context-val" style="font-size: 14px; color: var(--warning);">Volatile</span>
                    </div>
                </div>

                <div style="margin-top: 20px; padding: 10px; background: rgba(245, 158, 11, 0.1); border-radius: 6px; font-size: 12px; color: var(--warning);">
                    <strong>Forecast:</strong> Current volatility favors <strong>Trend Following</strong> but increases risk for <strong>Breakout</strong> setups. Maintain strict stop losses.
                </div>
            </div>
        </div>
    </div>

    <!-- VIEW 2: Performance -->
    <div id="view-performance" class="view-section">
        <div class="kpi-grid" style="margin-bottom: 20px;">
            <div class="kpi-card">
                <div class="kpi-label">Net P&L</div>
                <div class="kpi-value text-green">+$3,450.00</div>
                <div class="kpi-trend text-green">‚Üó +12% vs last month</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Win Rate</div>
                <div class="kpi-value">62.5%</div>
                <div class="kpi-trend text-muted">‚Üí Stable</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Profit Factor</div>
                <div class="kpi-value">2.1</div>
                <div class="kpi-trend text-green">‚Üó Improving</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Avg R:R</div>
                <div class="kpi-value">1:2.5</div>
                <div class="kpi-trend text-muted">‚Üí On Target</div>
            </div>
        </div>

        <div class="card">
            <div class="header-row">
                <h3>Equity Curve</h3>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-outline" style="padding: 4px 10px; font-size: 11px;">1M</button>
                    <button class="btn btn-primary" style="padding: 4px 10px; font-size: 11px;">3M</button>
                    <button class="btn btn-outline" style="padding: 4px 10px; font-size: 11px;">YTD</button>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-placeholder">Equity Curve Visualization Placeholder</div>
            </div>
        </div>
    </div>

    <!-- VIEW 3: Behavior -->
    <div id="view-behavior" class="view-section">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
            <div class="card">
                <h3>Emotional Distribution</h3>
                <p style="font-size: 13px; color: var(--text-muted);">How you felt during trade execution (Last 50 trades)</p>
                
                <div style="display: flex; align-items: center; justify-content: center; height: 200px; gap: 30px;">
                    <!-- CSS Pie Chart Placeholder -->
                    <div style="width: 120px; height: 120px; border-radius: 50%; background: conic-gradient(var(--primary) 0% 45%, var(--danger) 45% 65%, var(--warning) 65% 85%, var(--success) 85% 100%);"></div>
                    
                    <div style="display: flex; flex-direction: column; gap: 10px; font-size: 13px;">
                        <div style="display: flex; align-items: center; gap: 8px;"><span style="width: 10px; height: 10px; background: var(--primary); border-radius: 2px;"></span> Calm (45%)</div>
                        <div style="display: flex; align-items: center; gap: 8px;"><span style="width: 10px; height: 10px; background: var(--danger); border-radius: 2px;"></span> Fear (20%)</div>
                        <div style="display: flex; align-items: center; gap: 8px;"><span style="width: 10px; height: 10px; background: var(--warning); border-radius: 2px;"></span> Greed (20%)</div>
                        <div style="display: flex; align-items: center; gap: 8px;"><span style="width: 10px; height: 10px; background: var(--success); border-radius: 2px;"></span> Confident (15%)</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3>P&L Impact by Emotion</h3>
                <p style="font-size: 13px; color: var(--text-muted);">Average P&L per trade based on reported emotion</p>
                
                <div style="margin-top: 30px; display: flex; flex-direction: column; gap: 15px;">
                    <div>
                        <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 5px;">
                            <span>Calm</span>
                            <span class="text-green">+$120 / trade</span>
                        </div>
                        <div style="width: 100%; background: var(--bg-panel); height: 8px; border-radius: 4px;">
                            <div style="width: 80%; background: var(--primary); height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 5px;">
                            <span>Fear</span>
                            <span class="text-red">-$45 / trade</span>
                        </div>
                        <div style="width: 100%; background: var(--bg-panel); height: 8px; border-radius: 4px;">
                            <div style="width: 30%; background: var(--danger); height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 5px;">
                            <span>Greed</span>
                            <span class="text-red">-$80 / trade</span>
                        </div>
                        <div style="width: 100%; background: var(--bg-panel); height: 8px; border-radius: 4px;">
                            <div style="width: 50%; background: var(--danger); height: 100%; border-radius: 4px;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="header-row">
                <h3>Emotion-DMI Correlation Heatmap</h3>
                <div style="font-size: 12px; color: var(--text-muted);">
                    <span style="margin-right: 15px;">Color = DMI Score (Quality)</span>
                    <span style="display: inline-block; width: 10px; height: 10px; background: #064e3b;"></span> High
                    <span style="display: inline-block; width: 10px; height: 10px; background: #7f1d1d; margin-left: 5px;"></span> Low
                </div>
            </div>
            <p style="font-size: 13px; color: var(--text-muted);">
                Identify which strategies trigger your worst performance under different emotions.
            </p>

            <div class="heatmap-container">
                <!-- Header Row -->
                <div></div>
                <div class="hm-header">Breakout</div>
                <div class="hm-header">Reversal</div>
                <div class="hm-header">Pullback</div>
                <div class="hm-header">Scalp</div>
                <div class="hm-header">News Trade</div>

                <!-- Row 1: Calm -->
                <div class="hm-label">Calm</div>
                <div class="hm-cell" style="background: #065f46;">0.92</div> <!-- High Green -->
                <div class="hm-cell" style="background: #047857;">0.85</div>
                <div class="hm-cell" style="background: #059669;">0.78</div>
                <div class="hm-cell" style="background: #10b981;">0.72</div>
                <div class="hm-cell" style="background: #34d399; color: #111;">0.65</div>

                <!-- Row 2: Fear -->
                <div class="hm-label">Fear</div>
                <div class="hm-cell" style="background: #b91c1c;">0.35</div> <!-- Red -->
                <div class="hm-cell" style="background: #991b1b;">0.42</div>
                <div class="hm-cell" style="background: #7f1d1d;">0.25</div> <!-- Deep Red -->
                <div class="hm-cell" style="background: #ef4444;">0.45</div>
                <div class="hm-cell" style="background: #f87171; color: #111;">0.50</div>

                <!-- Row 3: Greed -->
                <div class="hm-label">Greed</div>
                <div class="hm-cell" style="background: #d97706;">0.55</div> <!-- Orange -->
                <div class="hm-cell" style="background: #b45309;">0.48</div>
                <div class="hm-cell" style="background: #92400e;">0.40</div>
                <div class="hm-cell" style="background: #f59e0b; color: #111;">0.58</div>
                <div class="hm-cell" style="background: #fbbf24; color: #111;">0.60</div>

                <!-- Row 4: Confident -->
                <div class="hm-label">Confident</div>
                <div class="hm-cell" style="background: #064e3b;">0.95</div> <!-- Deep Green -->
                <div class="hm-cell" style="background: #065f46;">0.88</div>
                <div class="hm-cell" style="background: #047857;">0.82</div>
                <div class="hm-cell" style="background: #059669;">0.75</div>
                <div class="hm-cell" style="background: #ef4444;">0.40</div> <!-- Overconfidence trap -->
            </div>
            
            <div style="margin-top: 20px; font-size: 13px; color: var(--text-muted); font-style: italic;">
                * Note: High confidence during "News Trade" correlates with a sharp drop in DMI (0.40), suggesting a tendency to gamble on news.
            </div>
        </div>
    </div>

    <!-- VIEW 4: AI Report -->
    <div id="view-ai-report" class="view-section">
        <div class="card">
            <div class="header-row">
                <h3>AI Performance Reports</h3>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-outline">Export Report</button>
                    <button class="btn btn-primary">Generate New Report</button>
                </div>
            </div>
            <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 20px;">
                Comprehensive analysis of your trading behavior, DMI trends, and performance metrics.
            </p>

            <div class="report-list">
                <div class="report-item" onclick="window.open('../ai_report/ai_report%20-%20combined.html', '_blank')" title="Click to view demo report">
                    <div class="report-meta">
                        <span class="report-name">Weekly Insight Report (Demo)</span>
                        <span class="report-date">Dec 15, 2025 ‚Ä¢ 10:00 AM</span>
                    </div>
                    <span class="report-status">Ready</span>
                </div>
                <div class="report-item">
                    <div class="report-meta">
                        <span class="report-name">Monthly Performance Review</span>
                        <span class="report-date">Dec 01, 2025 ‚Ä¢ 09:30 AM</span>
                    </div>
                    <span class="report-status">Ready</span>
                </div>
                <div class="report-item">
                    <div class="report-meta">
                        <span class="report-name">Weekly Insight Report</span>
                        <span class="report-date">Nov 24, 2025 ‚Ä¢ 10:00 AM</span>
                    </div>
                    <span class="report-status">Ready</span>
                </div>
            </div>
        </div>
    </div>

</main>

<script>
    const titles = {
        'dmi': { title: 'Discipline Management Index', desc: 'Monitor your execution quality and psychological state.' },
        'performance': { title: 'Performance', desc: 'Track your P&L, Win Rate, and Equity Curve.' },
        'behavior': { title: 'Behavior & Discipline', desc: 'Analyze your emotional state and its impact on trading.' },
        'ai-report': { title: 'AI Report', desc: 'Generate and view comprehensive performance reports.' }
    };

    function switchView(viewId, el) {
        // Update Nav - Â¶ÇÊûúÊ≤°Êúâ‰º†ÂÖ•elÔºåÂàô‰ΩøÁî®updateSidebarActive
        if (el) {
            document.querySelectorAll('.nav-sub-item').forEach(p => p.classList.remove('active'));
            el.classList.add('active');
        }

        // Update View
        document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
        document.getElementById('view-' + viewId).classList.add('active');

        // Update Header
        const info = titles[viewId];
        if (info) {
            // Update Topbar Title
            const topbarTitle = document.getElementById('topbar-page-title');
            if (topbarTitle) {
                topbarTitle.textContent = info.title;
            }
            // Update Page Description
            const pageDesc = document.getElementById('page-desc');
            if (pageDesc) {
                pageDesc.textContent = info.desc;
            }
        }
    }

    // DMI Logic
    function updateDMI(score) {
        const mercury = document.getElementById('dmi-mercury');
        const scoreText = document.getElementById('dmi-score');
        const badge = document.getElementById('dmi-badge');
        const desc = document.getElementById('dmi-desc');
        
        // Update Height & Text
        mercury.style.height = `${score}%`;
        scoreText.textContent = score;

        // 1. Dynamic Color Gradient (HSL)
        // Map 0-100 score to 0-120 Hue (Red -> Green)
        const hue = (score / 100) * 120;
        const colorStart = `hsl(${hue}, 80%, 45%)`;
        const colorEnd = `hsl(${hue}, 90%, 60%)`;
        const shadowColor = `hsla(${hue}, 80%, 50%, 0.5)`;

        // Apply Gradient
        mercury.style.background = `linear-gradient(to top, ${colorStart} 0%, ${colorEnd} 100%)`;
        mercury.style.boxShadow = `0 0 15px ${shadowColor}`;

        // 2. Update Status Text & Badge
        if (score >= 70) {
            badge.className = 'regime-badge regime-strong';
            badge.innerHTML = 'üü¢ Strong Discipline';
            desc.innerHTML = 'Your trading discipline is currently in the <strong>Strong Zone</strong>. You are executing your strategy with high consistency.';
        } else if (score >= 40) {
            badge.className = 'regime-badge regime-stable';
            badge.innerHTML = 'üü† Stable Discipline';
            desc.innerHTML = 'Your trading discipline is in the <strong>Stable Zone</strong>. Be cautious of emotional triggers appearing in your recent trades.';
        } else {
            badge.className = 'regime-badge regime-risky';
            badge.innerHTML = 'üî¥ Risky State';
            desc.innerHTML = 'Your trading discipline has fallen into the <strong>Risky Zone</strong>. Immediate pause recommended to reset mental state.';
        }
    }

    // Initialize DMI with demo value
    window.addEventListener('DOMContentLoaded', () => {
        updateDMI(82);
    });
</script>

</body>
</html>